<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tensor Flo Ridas: A Journey in ML</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="custom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">EDLD654</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="page1_data.html">
    <span class="fa fa-database"></span>
     
    The Data
  </a>
</li>
<li>
  <a href="page2_linear.html">
    <span class="fa fa-chart-line"></span>
     
    Linear Model
  </a>
</li>
<li>
  <a href="page3_rf.html">
    <span class="fa fa-tree"></span>
     
    Random Forest
  </a>
</li>
<li>
  <a href="page4_xgboost.html">
    <span class="fa fa-rocket"></span>
     
    Boosted Tree
  </a>
</li>
<li>
  <a href="page5_comparison.html">
    <span class="fa fa-balance-scale"></span>
     
    Model Comparisons
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/camkay/edld654_blog">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Tensor Flo Ridas: A Journey in ML</h1>

</div>


<hr />
<div id="linear-model" class="section level1">
<h1>Linear Model</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>A brief recap, our project aims to predict student math and reading test score for 3rd to 8th grade students in Oregon using data from the National Center for Educational Statistics.</p>
<p>To obtain a general understanding of how our predictor variables fit our data, we begin by fitting a basic linear regression model to our data akin to <code>stats::lm</code>. Our criteria for evaluation of model fit will be the root mean square error (RMSE). The result of the linear model will be used to inform subsequent model selection and tuning.</p>
<p>We will use the following recipe (for more information, <a href="page1_data.html">see our Data section</a>) to fit our model.</p>
<pre class="r"><code>rec &lt;- recipe(score ~ ., data_train) %&gt;%  
    step_mutate(tst_dt = lubridate::mdy_hm(tst_dt)) %&gt;%
    update_role(contains(&quot;id&quot;), ncessch, sch_name, new_role = &quot;id vars&quot;) %&gt;%
    step_novel(all_nominal()) %&gt;%
    step_unknown(all_nominal()) %&gt;%
    step_zv(all_predictors()) %&gt;%
    step_normalize(all_numeric(), -all_outcomes(), -has_role(&quot;id vars&quot;)) %&gt;%
    step_BoxCox(all_numeric(), -all_outcomes(), -has_role(&quot;id vars&quot;)) %&gt;%
    step_medianimpute(all_numeric(), -all_outcomes(), -has_role(&quot;id vars&quot;)) %&gt;%
    step_dummy(all_nominal(), -has_role(&quot;id vars&quot;), one_hot = TRUE) %&gt;%
    step_zv(all_predictors())

rec</code></pre>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    id vars          7
##    outcome          1
##  predictor         45
## 
## Operations:
## 
## Variable mutation for tst_dt
## Novel factor level assignment for all_nominal()
## Unknown factor level assignment for all_nominal()
## Zero variance filter on all_predictors()
## Centering and scaling for all_numeric(), ...
## Box-Cox transformation on all_numeric(), ...
## Median Imputation for all_numeric(), ...
## Dummy variables from all_nominal(), -has_role(&quot;id vars&quot;)
## Zero variance filter on all_predictors()</code></pre>
<p>As shown in our recipe summary, our recipe contains 7 id variables (these variables will not be used in our prediction), 1 outcome (test score) and 45 predictors.</p>
</div>
<div id="build-linear-model" class="section level2">
<h2>Build Linear Model</h2>
<p>To build our model, we will use the <a href="https://parsnip.tidymodels.org/"><code>parsnip</code></a> and <a href="https://workflows.tidymodels.org/"><code>workflows</code></a> package that is a part of the <a href="https://www.tidymodels.org/"><code>tidymodels</code></a> family of packages developed to facilitate modeling and machine learning.</p>
<p><code>parsnip</code> provides an unified interface of common machine learning algorithms where users simply have to specify the model and engine rather than having to remember model specifications that may differ across different algorithm packages. Here is a reference <a href="https://www.tidymodels.org/find/parsnip/">library</a> of <code>parsnip</code> models.</p>
<p>Once we have created our recipe and <code>parsnip</code> model, we can then use <code>workflows</code> to combine our recipe and model together to fit our 10-fold cross validation (CV) data.</p>
<p>We specify our <code>parsnip</code> linear model by setting the engine as <code>lm</code> and mode as <code>regression</code> given our outcome variable (test score) is continous.</p>
<pre class="r"><code>#create model 
lin_mod &lt;- linear_reg() %&gt;% 
  set_engine(&quot;lm&quot;)  %&gt;% 
  set_mode(&quot;regression&quot;)

lin_mod</code></pre>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Computational engine: lm</code></pre>
<p>We then use <code>add_recipe()</code> and <code>add_model()</code> to combine our recipe and linear model into a workflow.</p>
<pre class="r"><code>#create workflow
lin_workflow &lt;- workflow() %&gt;% 
  add_recipe(recipe_1) %&gt;% 
  add_model(lin_mod)</code></pre>
</div>
<div id="fit-linear-model" class="section level2">
<h2>Fit Linear Model</h2>
<p>We now fit our 10-fold CV data to our linear model using <code>fit_resamples()</code> which fits a single model and recipe across mulitple resamples.</p>
<pre class="r"><code>#run model 
start_rf &lt;- Sys.time()

lin_fit &lt;- fit_resamples(
  lin_workflow,
  data_train_cv,
  metrics = yardstick::metric_set(rmse), 
  control = control_resamples(verbose = TRUE, 
                              save_pred = TRUE))
end_rf &lt;- Sys.time()
lin_time &lt;- end_rf - start_rf</code></pre>
<p>Our linear model took 1.44 minutes to run.</p>
</div>
<div id="collect-metrics" class="section level2">
<h2>Collect Metrics</h2>
<p>After sucessfully running our model, we collect our RMSE to evaluate model fit. Listed below are the RMSE for each individual fold across our 10-fold CV along with the average RMSE across the 10-fold.</p>
<pre class="r"><code># see all RMSE
lin_fit %&gt;% 
  collect_metrics(summarize = FALSE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".metric"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[3],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Fold01","2":"rmse","3":"standard","4":"86.56269"},{"1":"Fold02","2":"rmse","3":"standard","4":"86.22152"},{"1":"Fold03","2":"rmse","3":"standard","4":"88.29569"},{"1":"Fold04","2":"rmse","3":"standard","4":"87.73753"},{"1":"Fold05","2":"rmse","3":"standard","4":"86.87353"},{"1":"Fold06","2":"rmse","3":"standard","4":"86.53520"},{"1":"Fold07","2":"rmse","3":"standard","4":"87.84028"},{"1":"Fold08","2":"rmse","3":"standard","4":"86.38722"},{"1":"Fold09","2":"rmse","3":"standard","4":"86.71335"},{"1":"Fold10","2":"rmse","3":"standard","4":"86.91210"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># see average RMSE 
lin_fit %&gt;%
  collect_metrics()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["std_err"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"rmse","2":"standard","3":"87.00791","4":"10","5":"0.2216828"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The average RMSE for our linear model on the 10-fold CV was 87.01</p>
</div>
</div>
<div id="make-prediction" class="section level1">
<h1>Make Prediction</h1>
<p>To evaluate how well our trained linear model is able to predict un-trained or un-seen data, we will now make predictions on our left out dataset from our initial split.</p>
<pre class="r"><code>#run the model on the withheld test set from the initial split 
start_rf &lt;- Sys.time()

mod_lin_final &lt;- last_fit(
lin_workflow, 
split = data_split)

end_rf &lt;- Sys.time()
lin_final_time &lt;- end_rf - start_rf</code></pre>
<p>Applying the linear model to our left out dataset from our initial split was much faster (took only 9.27 seconds to run!) compared to our 10-fold cv training data (1.44 min) where the model was fitted across multiple folds.</p>
<div id="collect-metrics-1" class="section level2">
<h2>Collect Metrics</h2>
<pre class="r"><code>mod_lin_final %&gt;% 
  collect_metrics()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[".metric"],"name":[1],"type":["chr"],"align":["left"]},{"label":[".estimator"],"name":[2],"type":["chr"],"align":["left"]},{"label":[".estimate"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"rmse","2":"standard","3":"86.9756035"},{"1":"rsq","2":"standard","3":"0.4365051"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The average RMSE for our linear model on the withheld test data was 86.98. This is a very slight improvement in RMSE compared to the RMSE of 87.01 obtained in our 10-fold cv training data.</p>
</div>
</div>
<div id="plot---important-predictors" class="section level1">
<h1>Plot - Important Predictors</h1>
<p>We can plot the most important predictors in our linear model using the <code>vip</code> package.</p>
<pre class="r fold-hide"><code>mod_lin_final %&gt;% 
  pluck(&quot;.workflow&quot;, 1) %&gt;%   
  pull_workflow_fit() %&gt;% 
  vip(num_features = 20, 
      aesthetics = list(fill = &quot;cyan3&quot;)) +
  labs(y = &quot;Variable Importance&quot;, 
       title = &quot;Variable Importance Plot for Linear Model&quot;) +
  theme_407() +
  theme(plot.title.position = &quot;plot&quot;) </code></pre>
<p><img src="page2_linear_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>From the plot, we can see that the variable <code>sp_ed_fg_N</code> which indicates whether a student participates in an Individualized Education Plan was one of the most important predictor of students’ test score. Other important predictors include students’ Limited English Proficiency status and ethnicity.</p>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
<p>The linear model provided an introduction to machine learning and a general estimate of the RMSE model fit based on all of our predictor variables. Using the linear model, our predictors were able to account for 43.65% of variance in our score with an RMSE of 86.98. Overall, the linear model was extremely quick to run computationally as the algorithm utilized was <code>lm</code> and there were no hyperparameter tuning involved at this most basic level.</p>
<p>For our subsequent model,s we will explore non-linear models that can be tuned for an optimal bias-variance balance.</p>
<div id="penalized-regression" class="section level2">
<h2>Penalized Regression</h2>
<hr />
<center>
<em>Last updated: December 07 2020.</em>
</center>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
